<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap');
        body {
            font-family: 'Inter', sans-serif;
        }
    </style>
    <link rel="icon" type="image/png" href="{{ url_for('static', filename='favicon.png') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <title>{% block title %}App Dashboard{% endblock %}</title>
</head>

<body class="transition-colors duration-300">
<nav class="hidden md:block fixed top-0 left-0 h-screen w-64 p-4 z-20 transition-all duration-300
                bg-white border-r border-slate-200 shadow-xl
                dark:bg-gray-800 dark:border-gray-700">

    <div class="flex items-center space-x-2 p-2 mb-8 border-b border-slate-100 dark:border-gray-700/50">
    <svg fill="#972020" width="32px" height="32px" viewBox="-2.5 0 24 24" xmlns="http://www.w3.org/2000/svg" stroke="#972020"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"><path d="m13.656 17.338c-.857.989-1.334 2.79-.709 3.371.6.449 2.2.391 3.385-1.23.344-.487.551-1.093.551-1.747 0-.603-.175-1.164-.477-1.637l.007.012c-.73-.555-1.778.164-2.757 1.243zm-8.057.3c-.908-1.04-2.088-1.658-2.851-1.2-.51.382-.605 1.685.123 2.967 1.078 1.524 2.6 1.679 3.221 1.307.659-.488.3-2.137-.493-3.075zm4.105 3.145c-1.1-.026-2.8.439-2.776 1.032-.018.4 1.331 1.572 2.7 1.513 1.326.03 2.7-1.139 2.682-1.649s-1.5-.927-2.607-.884zm-.075-13.944c-1.275-.032-2.5.933-2.5 1.493 0 .68 1.008 1.376 2.51 1.394 1.543.01 2.518-.559 2.532-1.26.016-.794-1.394-1.639-2.518-1.627zm-3.071.532c-2.135-.345-3.913.9-3.842 3.192.07.884 4.63-3.041 3.843-3.177v-.015zm9.749 3.251c.071-2.277-1.709-3.521-3.844-3.176-.787.135 3.772 4.061 3.844 3.176zm.364.824c-1.239-.329-.42 5.049.588 4.615.551-.525.894-1.265.894-2.084 0-1.077-.592-2.015-1.468-2.508l-.014-.007v-.015zm-14.9 4.675c1.007.45 1.827-4.929.589-4.6-.891.504-1.483 1.445-1.483 2.525 0 .821.343 1.563.893 2.089l.001.001zm9.415-5.948c-.63.49-1.032 1.249-1.032 2.101 0 .624.215 1.197.575 1.65l-.004-.005c.492.838 1.388 1.392 2.414 1.392.467 0 .908-.115 1.295-.318l-.015.007c.631-.49 1.034-1.248 1.034-2.101 0-.624-.215-1.197-.576-1.65l.004.005c-.484-.835-1.374-1.388-2.393-1.388-.476 0-.923.121-1.314.333l.015-.007zm-3.1.135c-.373-.199-.816-.315-1.286-.315-1.02 0-1.911.548-2.395 1.366l-.007.013c-.357.45-.572 1.026-.572 1.652 0 .855.402 1.616 1.027 2.105l.006.004c.376.205.823.325 1.298.325 1.019 0 1.909-.553 2.386-1.376l.007-.013c.352-.448.564-1.019.564-1.64 0-.853-.4-1.612-1.024-2.1l-.006-.004zm4.369 7.162c-.077-1.399-1.23-2.504-2.641-2.504-.049 0-.098.001-.147.004h.007c-.028-.001-.062-.002-.095-.002-1.423 0-2.585 1.119-2.653 2.526v.006.029c.078 1.399 1.232 2.504 2.643 2.504.049 0 .098-.001.147-.004h-.007c.035.002.076.003.117.003 1.413 0 2.566-1.116 2.625-2.514v-.005-.029l.01-.015zm3.215-15.133c-1.69.771-3.14 1.756-4.396 2.945l.007-.007c.377 1.5 2.344 1.558 3.063 1.512-.139-.044-.251-.141-.314-.266l-.001-.003c.18-.12.821-.016 1.268-.255-.171-.03-.252-.061-.329-.2.432-.095.813-.255 1.156-.472l-.015.009c-.033.005-.07.009-.109.009-.132 0-.256-.037-.361-.1l.003.002c.419-.179.779-.4 1.103-.664l-.008.006c-.2 0-.406 0-.466-.075.336-.197.625-.429.875-.698l.002-.002c-.272.045-.39.016-.454-.03.295-.226.544-.494.742-.798l.007-.012c-.076.04-.166.063-.261.063s-.185-.023-.264-.064l.003.002c.091-.194.47-.314.69-.779-.073.019-.157.031-.243.031s-.17-.011-.25-.032l.007.002c.093-.328.242-.613.439-.859l-.004.005c-.095.004-.206.006-.318.006-.281 0-.558-.013-.832-.038l.035.003.283-.285c-.124-.024-.266-.038-.412-.038-.297 0-.58.058-.839.164l.015-.005c-.149-.105 0-.255.185-.4-.385.05-.734.138-1.065.262l.033-.011c-.164-.15.1-.285.24-.436-.413.071-.781.218-1.106.427l.012-.007c-.18-.165-.015-.314.1-.449-.354.137-.657.33-.916.57l.002-.002c-.09-.1-.209-.179-.06-.449-.291.162-.535.373-.73.624l-.004.005c-.194-.134-.119-.3-.119-.449-.285.253-.545.518-.785.8l-.009.011c-.061-.031-.1-.15-.135-.346-.779.75-1.889 2.623-.285 3.356 1.36-1.066 2.949-1.919 4.672-2.47l.107-.03.041-.075zm-12.259 0c1.831.583 3.42 1.441 4.808 2.542l-.031-.024c1.6-.75.493-2.623-.282-3.356-.041.194-.085.329-.135.359-.249-.292-.507-.557-.78-.803l-.008-.007c0 .15.077.33-.117.45-.193-.258-.434-.469-.71-.624l-.011-.006c.149.256.025.33-.056.449-.247-.258-.547-.462-.883-.594l-.017-.006c.12.149.3.3.12.465-.309-.203-.673-.35-1.064-.417l-.017-.002c.135.149.4.3.238.45-.301-.12-.65-.211-1.014-.256l-.021-.002c.181.15.342.289.192.4-.251-.11-.543-.173-.849-.173-.143 0-.284.014-.419.04l.014-.002.284.284c-.242.026-.523.041-.807.041-.11 0-.22-.002-.33-.007l.016.001c.199.238.35.525.432.839l.003.015c-.045.045-.27.016-.483 0 .225.449.6.57.688.765-.076.041-.166.065-.261.065s-.186-.024-.264-.066l.003.001c.219.307.465.573.741.805l.007.005c-.083.039-.181.061-.283.061-.064 0-.127-.009-.186-.025l.005.001c.251.269.537.5.851.69l.018.01c-.06.07-.271.069-.479.075.315.26.676.483 1.065.652l.029.011c-.102.071-.228.113-.365.113-.035 0-.07-.003-.104-.008h.004c.327.21.708.371 1.116.46l.023.004c-.071.118-.198.197-.344.2.449.254 1.078.135 1.258.27-.064.128-.175.225-.31.269l-.004.001c.719.045 2.7-.015 3.072-1.514-1.248-1.177-2.699-2.157-4.292-2.877l-.099-.04.04.016zm1.734-2.237c.243.033.463.103.664.205l-.012-.005c.529-.17.65.063.91.159.577-.12.752.141 1.029.419l.322-.009c.707.489 1.225 1.206 1.451 2.044l.006.025c.231-.862.749-1.579 1.445-2.057l.012-.008.321.007c.277-.28.452-.539 1.029-.418.261-.1.38-.33.911-.166.33-.1.62-.375 1.057-.045.131-.076.289-.121.457-.121.224 0 .429.08.589.213l-.001-.001c.5-.06.653.061.774.21.108 0 .809-.1 1.132.36.81-.09 1.064.464.774.988.114.121.185.284.185.464 0 .204-.091.387-.234.511l-.001.001c.15.269.062.553-.27.913.014.055.023.117.023.182 0 .284-.159.53-.393.655l-.004.002c.06.51-.48.81-.629.914-.061.3-.181.584-.8.734-.089.449-.464.523-.824.614 1.309.619 2.199 1.929 2.199 3.446 0 .1-.004.2-.012.298l.001-.013.181.3c.991.664 1.634 1.779 1.634 3.045 0 .953-.365 1.821-.963 2.472l.002-.003c-.139.635-.315 1.186-.535 1.713l.024-.065c-.211 1.48-1.197 2.687-2.528 3.209l-.027.01c-.697.564-1.506 1.025-2.384 1.344l-.058.019c-.745.815-1.809 1.328-2.993 1.337h-.094c-1.191-.007-2.262-.519-3.009-1.332l-.003-.003c-.938-.339-1.748-.801-2.463-1.378l.016.013c-1.358-.533-2.346-1.739-2.559-3.197l-.003-.022c-.198-.465-.376-1.021-.505-1.595l-.013-.067c-.599-.649-.966-1.519-.966-2.475 0-1.265.644-2.38 1.621-3.036l.013-.008.172-.3c-.007-.085-.011-.184-.011-.284 0-1.517.889-2.827 2.176-3.436l.023-.01c-.359-.09-.72-.165-.823-.615-.615-.15-.735-.434-.8-.734-.15-.105-.689-.4-.629-.928-.239-.13-.399-.38-.399-.667 0-.067.009-.131.025-.193l-.001.005c-.314-.346-.4-.645-.27-.915-.144-.123-.234-.305-.234-.508 0-.181.072-.346.189-.466-.285-.525-.03-1.094.779-1 .317-.465 1.023-.359 1.126-.359.121-.15.285-.285.779-.225.162-.133.371-.214.599-.214.165 0 .32.042.455.116l-.005-.002c.108-.097.249-.159.405-.166h.001z"></path></g></svg>
        <span class="text-2xl font-extrabold text-slate-800 dark:text-gray-100">Rasbhari</span>
    </div>

    <ul class="space-y-2">
        <li>
            <a href="/" class="flex items-center p-3 rounded-xl text-slate-700 font-semibold transition duration-150
                                 hover:bg-indigo-50 hover:text-indigo-600
                                 dark:text-gray-300 dark:hover:bg-gray-700 dark:hover:text-indigo-400
                                 {% if request.path == '/' %}bg-indigo-50 text-indigo-600 dark:bg-gray-700 dark:text-indigo-400{% endif %}">
                <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"
                     xmlns="http://www.w3.org/2000/svg">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                          d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path>
                </svg>
                Dashboard
            </a>
        </li>
        <li>
            <a href="/apps/home" class="flex items-center p-3 rounded-xl text-slate-700 font-semibold transition duration-150
                                 hover:bg-indigo-50 hover:text-indigo-600
                                 dark:text-gray-300 dark:hover:bg-gray-700 dark:hover:text-indigo-400
                                 {% if request.path == '/apps/home' %}bg-indigo-50 text-indigo-600 dark:bg-gray-700 dark:text-indigo-400{% endif %}">
                <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"
                     xmlns="http://www.w3.org/2000/svg">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                          d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                </svg>
                Apps
            </a>
        </li>
        <li>
            <a href="/processes/home" class="flex items-center p-3 rounded-xl text-slate-700 font-semibold transition duration-150
                                 hover:bg-indigo-50 hover:text-indigo-600
                                 dark:text-gray-300 dark:hover:bg-gray-700 dark:hover:text-indigo-400
                                 {% if request.path == '/processes/home' %}bg-indigo-50 text-indigo-600 dark:bg-gray-700 dark:text-indigo-400{% endif %}">
                <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"
                     xmlns="http://www.w3.org/2000/svg">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                          d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37a1.724 1.724 0 002.572-1.065zM15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                </svg>
                Processes
            </a>
        </li>
    </ul>

    <div class="absolute bottom-4 left-4 right-4 p-3 border-t border-slate-100 dark:border-gray-700/50">
        <button id="theme-toggle" onclick="toggleTheme()"
                class="flex items-center justify-center w-full p-2 text-sm text-slate-600 bg-slate-100 rounded-lg hover:bg-slate-200 transition-colors
                           dark:text-gray-300 dark:bg-gray-700 dark:hover:bg-gray-600">
            <svg id="sun-icon" class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"
                 xmlns="http://www.w3.org/2000/svg">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path>
            </svg>
            <svg id="moon-icon" class="w-5 h-5 mr-2 hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24"
                 xmlns="http://www.w3.org/2000/svg">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path>
            </svg>
            <span id="theme-text">Light Mode</span>
        </button>
    </div>
</nav>

<main id="content-wrapper" class="md:ml-64 min-h-screen transition-all duration-300 bg-slate-50 dark:bg-gray-900">
    {% block content %}{% endblock %}
</main>

<script>
    // Theme Toggle Logic
    function toggleTheme() {
        const html = document.documentElement;
        const isDarkMode = html.classList.toggle('dark');
        localStorage.setItem('theme', isDarkMode ? 'dark' : 'light');
        updateThemeIcons(isDarkMode);
    }

    function updateThemeIcons(isDarkMode) {
        const sunIcon = document.getElementById('sun-icon');
        const moonIcon = document.getElementById('moon-icon');
        const themeText = document.getElementById('theme-text');

        if (isDarkMode) {
            sunIcon.classList.remove('hidden');
            moonIcon.classList.add('hidden');
            themeText.textContent = 'Light Mode';
        } else {
            sunIcon.classList.add('hidden');
            moonIcon.classList.remove('hidden');
            themeText.textContent = 'Dark Mode';
        }
    }

    // Apply theme on load
    const storedTheme = localStorage.getItem('theme');
    // MODIFICATION 3: Logic simplified to prioritize stored theme, then default to dark if no preference is found
    if (storedTheme === 'dark' || (storedTheme === null && window.matchMedia('(prefers-color-scheme: light)').matches === false)) {
        document.documentElement.classList.add('dark');
        updateThemeIcons(true);
    } else {
        // If storedTheme is 'light' OR there is no stored theme and system preference is light
        document.documentElement.classList.remove('dark');
        updateThemeIcons(false);
    }
</script>
</body>
</html>